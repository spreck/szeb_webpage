{% extends "base.html" %}

{% block title %}Upload SZEB Data{% endblock %}

{% block head %}
{{ super() }}
<style>
  .upload-container {
    max-width: 800px;
    margin: 0 auto;
    padding: 20px;
  }
  .card {
    margin-bottom: 20px;
    border-radius: 8px;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
  }
  .card-header {
    background-color: #f8f9fa;
    font-weight: bold;
  }
  .file-input-container {
    position: relative;
    margin-bottom: 15px;
  }
  .file-input-label {
    display: block;
    padding: 8px 16px;
    background-color: #007bff;
    color: white;
    border-radius: 4px;
    cursor: pointer;
    text-align: center;
    transition: background-color 0.3s;
  }
  .file-input-label:hover {
    background-color: #0069d9;
  }
  .file-input {
    position: absolute;
    left: 0;
    top: 0;
    opacity: 0;
    width: 100%;
    height: 100%;
    cursor: pointer;
  }
  .file-name {
    margin-top: 8px;
    font-size: 0.9rem;
    color: #6c757d;
  }
  .related-files-container {
    display: none;
    margin-top: 10px;
    padding: 10px;
    background-color: #f8f9fa;
    border-radius: 4px;
  }
  .progress-container {
    margin-top: 20px;
    display: none;
  }
  .status-container {
    margin-top: 20px;
    display: none;
  }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid mt-4">
  <div class="row">
    <div class="col-md-12">
      <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
          <li class="breadcrumb-item"><a href="/admin">Admin Dashboard</a></li>
          <li class="breadcrumb-item active" aria-current="page">Upload SZEB Data</li>
        </ol>
      </nav>

      <div class="upload-container">
        <h2 class="mb-4">Upload SZEB Species Data</h2>
        
        <div class="card">
          <div class="card-header">
            Upload SZEB Species Data
          </div>
          <div class="card-body">
            <form id="szebUploadForm" enctype="multipart/form-data">
              <!-- Species Selection -->
              <div class="form-group mb-3">
                <label for="speciesCode">Species:</label>
                <select class="form-control" id="speciesCode" name="species_code" required>
                  <option value="">-- Select Species --</option>
                  <option value="PIPO">Ponderosa Pine (PIPO)</option>
                  <option value="PSME">Douglas Fir (PSME)</option>
                </select>
              </div>
              
              <!-- Workspace Selection -->
              <div class="form-group mb-3">
                <label for="workspace">GeoServer Workspace:</label>
                <input type="text" class="form-control" id="workspace" name="workspace" value="{{ workspace }}" required>
              </div>
              
              <!-- Template Species Selection -->
              <div class="form-group mb-3">
                <label for="templateSpecies">Template Species (Optional):</label>
                <select class="form-control" id="templateSpecies" name="template_species">
                  <option value="">-- None (Generate New Styles) --</option>
                  <option value="PIPO">Ponderosa Pine (PIPO)</option>
                  <option value="PSME">Douglas Fir (PSME)</option>
                </select>
                <small class="form-text text-muted">Select a species to use as a template for styling.</small>
              </div>
              
              <!-- Raster File Upload -->
              <div class="form-group mb-3">
                <label for="rasterFile">Raster GeoTIFF File:</label>
                <div class="file-input-container">
                  <label class="file-input-label">
                    Choose Raster File
                    <input type="file" id="rasterFile" name="raster_file" class="file-input" accept=".tif,.tiff" required>
                  </label>
                  <div id="rasterFileName" class="file-name">No file selected</div>
                </div>
                <small class="form-text text-muted">Upload the SZEBxPipo_raster_4326.tif or SZEBxPsme_raster_4326.tif file.</small>
              </div>
              
              <!-- Vector File Upload -->
              <div class="form-group mb-3">
                <label for="vectorFile">Vector Boundary Shapefile:</label>
                <div class="file-input-container">
                  <label class="file-input-label">
                    Choose Vector File
                    <input type="file" id="vectorFile" name="vector_file" class="file-input" accept=".shp" required>
                  </label>
                  <div id="vectorFileName" class="file-name">No file selected</div>
                </div>
                <small class="form-text text-muted">Upload the szeb_pipo_vector_unit_4326.shp or szeb_psme_vector_unit_4326.shp file.</small>
              </div>
              
              <!-- Related Shapefile Files -->
              <div id="relatedFilesContainer" class="related-files-container">
                <h6>Related Shapefile Files:</h6>
                <p class="mb-2 text-muted">Please upload the following associated files:</p>
                
                <div class="file-input-container">
                  <label class="file-input-label">
                    .dbf File
                    <input type="file" id="dbfFile" name="vector_related_dbf" class="file-input" accept=".dbf">
                  </label>
                  <div id="dbfFileName" class="file-name">No file selected</div>
                </div>
                
                <div class="file-input-container">
                  <label class="file-input-label">
                    .shx File
                    <input type="file" id="shxFile" name="vector_related_shx" class="file-input" accept=".shx">
                  </label>
                  <div id="shxFileName" class="file-name">No file selected</div>
                </div>
                
                <div class="file-input-container">
                  <label class="file-input-label">
                    .prj File
                    <input type="file" id="prjFile" name="vector_related_prj" class="file-input" accept=".prj">
                  </label>
                  <div id="prjFileName" class="file-name">No file selected</div>
                </div>
                
                <div class="file-input-container">
                  <label class="file-input-label">
                    Other Files
                    <input type="file" id="otherFiles" name="vector_related_other" class="file-input" multiple>
                  </label>
                  <div id="otherFilesName" class="file-name">No files selected</div>
                </div>
              </div>
              
              <!-- Submit Button -->
              <div class="form-group mt-4">
                <button type="submit" id="uploadButton" class="btn btn-primary">Upload SZEB Data</button>
                <button type="button" id="cancelButton" class="btn btn-secondary ms-2">Cancel</button>
              </div>
            </form>
            
            <!-- Progress Bar -->
            <div id="progressContainer" class="progress-container">
              <label>Upload Progress:</label>
              <div class="progress">
                <div id="uploadProgress" class="progress-bar" role="progressbar" style="width: 0%;" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">0%</div>
              </div>
            </div>
            
            <!-- Status Messages -->
            <div id="statusContainer" class="status-container">
              <div id="statusMessage" class="alert" role="alert"></div>
            </div>
          </div>
        </div>
        
        <!-- Result Section -->
        <div id="resultContainer" class="card" style="display: none;">
          <div class="card-header">
            Upload Results
          </div>
          <div class="card-body">
            <div id="resultContent"></div>
            <div class="mt-3">
              <a href="/admin" class="btn btn-primary">Back to Admin Dashboard</a>
              <button id="viewLayerButton" class="btn btn-success ms-2">View Layer</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- JavaScript for the SZEB upload form -->
<script src="{{ url_for('static', filename='js/admin/szeb-upload.js') }}"></script>
{% endblock %}